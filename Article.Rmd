---
title:         "Trends of SDR in Thessaloniki "
author:
  - Natsis Athanasios^[Laboratory of Atmospheric Physics,AUTH, natsisthanasis@gmail.com]
  - Jane Doe^[Institution Two, jane@example.org]
abstract:
  "Study of GHI and DNI radiation for 'clear sky' and all sly conditions."

documentclass:  article
classoption:    a4paper,oneside
fontsize:       10pt
geometry:       "left=0.5in,right=0.5in,top=0.5in,bottom=0.5in"
link-citations: yes
colorlinks:     yes

header-includes:
- \usepackage{caption}
- \usepackage{placeins}
- \captionsetup{font=small}

output:
  bookdown::pdf_document2:
    number_sections:  no
    fig_caption:      no
    keep_tex:         no
    latex_engine:     xelatex
    toc:              yes
    fig_width:        7
    fig_height:       4.5
    cache:            yes
  html_document:
    toc:        true
    fig_width:  7.5
    fig_height: 5
date: "`r format(Sys.time(), '%F')`"

---



```{r echo=F, include=F}
knitr::opts_chunk$set(comment    = ""      )
knitr::opts_chunk$set(dev        = "pdf"   )
# knitr::opts_chunk$set(dev        = "png"    )
knitr::opts_chunk$set(out.width  = "80%"   )
knitr::opts_chunk$set(fig.align  = "center" )
# knitr::opts_chunk$set(fig.pos    = '!h'    )

####  Set environment  ####
Sys.setenv(TZ = "UTC")
tic <- Sys.time()

par(pch = ".")

library(data.table, quietly = T, warn.conflicts = F)
library(pander,     quietly = T, warn.conflicts = F)
## Functions from `https://github.com/thanasisn/IStillBreakStuff/tree/main/FUNCTIONS/R`
source("~/CODE/FUNCTIONS/R/sumNA.R")
source("~/CODE/FUNCTIONS/R/linear_regrassion_capture.R")
source("~/CODE/FUNCTIONS/R/trig_deg.R")

####  Variables  ####
panderOptions('table.alignment.default', 'right')
panderOptions('table.split.table',        120   )

DATA_DIR  <- "/home/athan/DATA/Broad_Band"
CLEARdir  <- "/home/athan/DATA/Broad_Band/CS_id"
tag       <- paste0("Natsis Athanasios LAP AUTH ", strftime(Sys.time(), format = "%b %Y" ))
CS_file   <- "/home/athan/DATA/Common_application/Clear_Sky.Rds"


MIN_ELEVA  <- 5  ## use data when sun above that
SZA_BIN    <- 1  ## bin size of SZA
MIN_N      <- 4
SEAS_MIN_N <- 3

SUM_THRES  <- 50
SZA_THRES  <- 3
```


## Data description 

....... span

...... measuremetns CHP1 CM21

....... screening

....... Quality assurance [cite]



## Data preperation

```{r echo=F, include=T}

####  Get data from Clear sky id data  ####
input_files <- list.files( path       = CLEARdir,
                           pattern    = "Clear_Sky_[0-9]{4}.Rds",
                           full.names = T )

if ( !file.exists(CS_file) | max(file.mtime(input_files)) > file.mtime(CS_file)) {
    cat(paste("Load data from Clear Sky proccess from original\n"))
    DATA <- data.table()
    for (af in input_files) {
        temp <- readRDS(af)
        ## drop some data
        temp$CHP1temp        <- NULL
        temp$CHP1tempSD      <- NULL
        temp$CHP1tempUNC     <- NULL
        temp$CS_ref          <- NULL
        temp$Pressure_Source <- NULL
        temp$chp1TempCF      <- NULL
        temp$wattDIR_tmp_cr  <- NULL
        temp$wattDIR_unc_NT  <- NULL
        temp$wattDIR_unc_WT  <- NULL
        temp$wattHOR_tmp_cr  <- NULL
        temp$wattHOR_unc_NT  <- NULL
        temp$wattHOR_unc_WT  <- NULL

        DATA <- rbind(temp, DATA, fill = TRUE)
        rm(temp)
    }
    ## this is used by old scripts
    myRtools::write_RDS(object = DATA, file = CS_file)
} else {
    # cat(paste("Load data from Clear Sky proccess from parsed\n"))
    DATA <- readRDS(CS_file)
}

```


Due to the large measurement assertenty near the horizon we exclude all measurements
with greater than SZA $`r 90-MIN_ELEVA`^\circ$. Moreover, due to nearby hills and buildings
we remove data with azimuth angle between $35^\circ$ and $120^\circ$ and SZA greater than $`r 90-10`^\circ$.

```{r echo=F}
DATA <- DATA[ Elevat >= MIN_ELEVA ]
DATA <- DATA[ ! (Azimuth > 35 & Azimuth < 120 & Elevat < 10) ]
```




## Data selection



**END**

```{r include=T, echo=F}
tac <- Sys.time()
cat(sprintf("%s %s@%s %f mins\n\n",Sys.time(),Sys.info()["login"],Sys.info()["nodename"],difftime(tac,tic,units="mins")))
```

