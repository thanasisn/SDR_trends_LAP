---
title:         "Trends of downward SDR in Thessaloniki"
author:
  - Natsis Athanasios^[Laboratory of Atmospheric Physics, AUTH, natsisphysicist@gmail.com]
  - Alkiviadis Bais^[Laboratory of Atmospheric Physics, AUTH]
abstract:
  "Study of GHI and DNI radiation for 'clear-sky' and all-sky conditions."

documentclass:  article
classoption:    a4paper,oneside
fontsize:       12pt
geometry:       "left=0.75in,right=0.75in,top=0.75in,bottom=0.75in"
link-citations: yes
colorlinks:     yes
urlcolor:       blue
bibliography:   [references.bib]
biblio-style:   apalike
date:           "`r format(Sys.time(), '%F')`"
    
header-includes:
  - \usepackage{caption}
  - \usepackage{placeins}
  - \captionsetup{font=small}
  - \usepackage{setspace}\doublespacing
  - \usepackage{float}

output:  
  bookdown::pdf_document2:
    number_sections: no
    fig_caption:     yes
    keep_tex:        no
    latex_engine:    xelatex
    toc:             yes
    toc_depth:       4
    fig_width:       7
    fig_height:      4.5
  html_document:
    toc:             true
    fig_width:       7.5
    fig_height:      5

---



```{r echo=F, include=T}
## document configurations 
knitr::opts_chunk$set(comment    = ""      )
knitr::opts_chunk$set(dev        = "pdf"   )
knitr::opts_chunk$set(out.width  = "70%"   )
knitr::opts_chunk$set(fig.align  = "center")
knitr::opts_chunk$set(fig.pos    = '!h'    )
library(pander)
library(data.table)
## load data
load("./data/common_data_14_2.Rda")
## variables we use
source("~/MANUSCRIPTS/2022_sdr_trends/DHI_GHI_0_variables.R")
```




# Introduction.

<!-- time span -->
The global radiation was obtained from the pyranometer CM-21, for the period
`r min(ALL_1_daily_DESEAS$Date)` -  `r max(ALL_1_daily_DESEAS$Date)`.
In some algorithms we used direct radiation data for comparisons, obtained by a CM-21 pyrheliometer, with data span
`r min(ALL_1_daily_DESEAS[!is.na(DIR_att), Date])` - `r max(ALL_1_daily_DESEAS[!is.na(DIR_att), Date])`.


<!-- goals -->
Here we investigate the trend on shortwave radiation for the last decades at Thessaloniki, and try to infer a relation to sky conditions (all, clear, cloudy).

<!-- basic concepts -->
Our method to characterize the sky conditions and the definition of each sky condition has some subjectivity. The algorithm was calibrated with the main focus to identify the presence of clouds on the sky dome, although there are marginal cases that there will be false positives or false negateives.




# Data and methodology.

## Preparation.

We can separate the data preparation in three parts, a) the acquisition of radiation measurements from the sensor, b) a radiation data quality check, and c) the identification of "clear sky" conditions from the radiometric data.

### Acquisition of radiometric data.

<!-- measurement -->
We sample the signal of the CM-21 pyranometer with a rate of $1 {Hz}$, and record the average signal and the standard deviation over each minute of the hour.
<!-- dark correction -->
The measurements are corrected for the zero offset of the instrument, using the "dark signal" (Sun elevation bellow $10^\circ$, for a period of $3 h$).
<!-- physical quantities -->
The signal is converted to radiation using a ramped value of the instrument sensitivity, derived from the eight laboratory calibrations of the instrument, during the study period.

### Radiation data quality check

<!-- screening -->
A manual screening is performed, to remove inconsistencies and erroneous recordings, that can occur during a long continuous operation.
<!-- Quality assurance -->
The manual screening is aided by a radiation data quality assurance procedure, adjusted for this site, based on methods of Long and Shi\ [-@long_automated_2008; -@Long2006]. 

....
Only data characterized as good quality were used in this study.
.....

### Clear-sky identification

In order to estimate the effect of the clouds on the global radiation we create three datasets. 
The all sky conditions containing all the valid measurements. 
The clear-sky conditions data and the remainder part the cloudy condition data. 
To identify the clear-sky conditions we used a method proposed by @Long2000 and by @Reno2016 that was adapted and configured for the site.


## Data process.


### Data selection 

Due to a significant measurement uncertainty near the horizon, we exclude
all measurements with SZA greater than $`r 90-MIN_ELEVA`^\circ$. 
Moreover, due to some obstructions around the site (hills and buildings), we exclude data with Azimuth angle between 
$35^\circ$ and $120^\circ$ and SZA greater than $80^\circ$.
At those cases the Sun systematically, is not visible by the instruments.

To make the measurements comparable throughout the dataset. 
<!-- 1au -->
We adjusted all 1-minute radiometric values to the mean Sun - Earth distance.
<!-- TSI -->
<!-- And, we made all measurements relative to the TSI at 1au, in order to compensate for the Suns intensity variability, using a homogenized timeseries of satellite TSI observations. As a result, we processed all radiation data as a fraction of Suns TSI. -->


### Process and aggregation of radiometric data

In this study, we present any radiometric data as a percent departure from the corresponding seasonal mean.
When we use daily aggregated data we compute the mean values for the day and exclude instances with less than `r Daily_aggregation_N_lim` valid data points.
Accordingly, monthly values are computed from the daily aggregated data, month with less than `r Monthly_aggegation_N_lim` days are rejected. 
The daily seasonal values are computed based on the day of year number and the monthly by the calendar month.

<!-- Seasonal -->
For the seasons of the year trends we grouped the mean daily values by season (December - February: Winter, March - May: Spring, etc.)


# Results

\FloatBarrier

## Long term trends


Using the mean daily Global radiation we produce the trends of each data set, as departure from the seasonal value.

```{r trendALL, echo=F, fig.cap="Daily Global radiation seasonal anomaly and long term trend, for all sky conditions."}
knitr::include_graphics("./images/LongtermTrends-2.pdf")
```


<!-- ```{r trendCLEAR, echo=F, fig.cap="Daily Global radiation seasonal anomaly and long term trend, for clear sky conditions."} -->
<!-- knitr::include_graphics("./images/LongtermTrends-4.pdf") -->
<!-- ``` -->


```{r trendCLOUD, echo=F, fig.cap="Daily Global radiation seasonal anomaly and long term trend, for cloud sky conditions."}
knitr::include_graphics("./images/LongtermTrends-6.pdf")
```


\footnotesize
```{r trendtable, echo=F}
pp <- read.csv("./figures/tbl_longterm_trends.dat",
               strip.white = TRUE,
               sep = ";",
               header = TRUE)
pp <- pp[grep("Global" ,pp$var), ]
pp$slope.sd           <- NULL
pp$slope.ConfInt_0.95 <- NULL
pp$slope.ConfInt_0.99 <- NULL
pp$var                <- NULL
rownames(pp) <- NULL
names(pp) <- c("Trend %/year", "Trend p-value", "Sky condition", "Trend statistical significance")

panderOptions("table.alignment.default", "left")
pander(pp,
       caption = "Trends of daily means by sky conditions.")
```
\normalsize




\FloatBarrier

## Long term trends by season of year


```{r seasonalALL, echo=F, fig.cap="Trends by season for All-sky condition. Displays monthly means of daily means."}
knitr::include_graphics("./images/SeasonaltTrends-1.pdf")
```

```{r seasonalCLEAR, echo=F, fig.cap="Trends by season for Clear-sky condition. Displays monthly means of daily means."}
knitr::include_graphics("./images/SeasonaltTrends-2.pdf")
```

```{r seasonalCLOUD, echo=F, fig.cap="Trends by season for Cloudy-sky condition. Displays monthly means of daily means."}
knitr::include_graphics("./images/SeasonaltTrends-3.pdf")
```




\footnotesize
```{r trendseasontable, echo=F}
pp <- read.csv("./figures/tbl_longterm_trends_season.dat",
               strip.white = TRUE,
               sep = ";",
               header = TRUE)
pp <- pp[grep("Global" ,pp$var), ]
pp$slope.sd           <- NULL
pp$slope.ConfInt_0.95 <- NULL
pp$slope.ConfInt_0.99 <- NULL
pp$var                <- NULL
rownames(pp) <- NULL
names(pp) <- c("Trend %/year", "Trend p-value", "Sky condition", "Season", "Trend statistical sign.")

panderOptions("table.alignment.default", "left")
pander(pp,
       caption = "Trends of daily means by sky conditions.")
```
\normalsize




\FloatBarrier

## Zenith angle dependence and years seasons.




\FloatBarrier

## Consistency of the trends



```{r cm, echo=F, fig.cap="Donditions."}
knitr::include_graphics("./images/CumulativeDailyCumSum-1.pdf")
```





# Conclusions



---------------------------




## Aggregation 

Both dataset were aggregate in $1^\circ$ SZA bins by am, pm, am+pm

by daily mean 

daily sum

seasonal daily mean

<!-- Deseasonalization -->
We remove the natural occurring seasonal variation, by calculating the mean
values for the corresponding time step, and subtracting them .........



## Long-term trends


This is it \@ref(fig:trendALL).


\FloatBarrier


<!--\tiny -->
```{r echo=F}
pp <- data.table::fread("./figures/tbl_longterm_trends.dat")
pander::pander(pp,
               caption = "Table of trends and stats")
```
<!--\normalsize-->


Some more text here


**END**

